/* Kreiranje tablice POSUDBA s dodanim constraint-ovima i ON DELETE NO ACTION */
CREATE TABLE POSUDBA (
    TABID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY 
        (START WITH 1 INCREMENT BY 1 NO MAXVALUE ORDER), /* TABID - ID posudbe */
    TABIDKNJ INTEGER NOT NULL, /* TABIDKNJ - ID knjige (strani kljuè) */
    TABIDCLAN INTEGER NOT NULL, /* TABIDCLAN - ID èlana (strani kljuè) */
    TABDATPOS DATE, /* TABDATPOS - Datum posudbe */
    
    /* Definiranje primarnog kljuèa s imenom */
    CONSTRAINT PK_POSUDBA PRIMARY KEY (TABID), 

    /* Definiranje stranog kljuèa za knjige s ON DELETE NO ACTION */
    CONSTRAINT FK_POSUDBA_KNJIGA FOREIGN KEY (TABIDKNJ) 
        REFERENCES KNJIGE(TABID) 
        ON DELETE NO ACTION, /* Ako postoji posudba, knjiga se ne mo¾e obrisati */

    /* Definiranje stranog kljuèa za èlanove s ON DELETE NO ACTION */
    CONSTRAINT FK_POSUDBA_CLAN FOREIGN KEY (TABIDCLAN) 
        REFERENCES CLANOVI(TABID) 
        ON DELETE NO ACTION /* Ako postoji posudba, èlan se ne mo¾e obrisati */
);

/* Kreiranje jedinstvenog indeksa za kolonu TABID */
CREATE UNIQUE INDEX IDX_UNIQUE_POSUDBA_ID
ON POSUDBA (TABID);

/* Kreiranje view-a za tablicu POSUDBA s originalnim nazivima kolona */
CREATE VIEW VIEW_POSUDBA AS
    SELECT 
        TABID AS ID, /* ID posudbe */
        TABIDKNJ AS IDKNJ, /* ID knjige */
        TABIDCLAN AS IDCLAN, /* ID èlana */
        TABDATPOS AS DATPOS /* Datum posudbe */
 FROM POSUDBA;
 
/* Dodavanje komentara na stupce */
COMMENT ON COLUMN POSUDBA.TABID 
    IS 'TABID - ID posudbe';

COMMENT ON COLUMN POSUDBA.TABIDKNJ 
    IS 'TABIDKNJ - ID knjige';

COMMENT ON COLUMN POSUDBA.TABIDCLAN 
    IS 'TABIDCLAN - ID èlana';

COMMENT ON COLUMN POSUDBA.TABDATPOS 
    IS 'TABDATPOS - Datum posudbe';
