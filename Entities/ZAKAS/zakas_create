/* Kreiranje tablice ZAKAS s dodanim constraint-ovima i ON DELETE NO ACTION */
CREATE TABLE ZAKAS (
    TABID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY 
        (START WITH 1, INCREMENT BY 1 NO MAXVALUE ORDER), /* TABID - ID zakasnine */
    TABIDCLAN INTEGER NOT NULL, /* TABIDCLAN - ID èlana (strani kljuè) */
    TABIDPOS INTEGER NOT NULL, /* TABIDPOS - ID posudbe (strani kljuè) */
    TABZAKDAT DATE, /* TABZAKDAT - Datum zakasnine */
    TABIZNOS INTEGER, /* TABIZNOS - Iznos zakasnine */
    
    /* Definiranje primarnog kljuèa s imenom */
    CONSTRAINT PK_ZAKAS PRIMARY KEY (TABID), 

    /* Definiranje stranog kljuèa za èlanove s ON DELETE NO ACTION */
    CONSTRAINT FK_ZAKAS_CLAN FOREIGN KEY (TABIDCLAN) 
        REFERENCES CLANOVI(TABID) 
        ON DELETE NO ACTION, /* Ako postoji zakasnina, èlan se ne mo¾e obrisati */

    /* Definiranje stranog kljuèa za posudbe s ON DELETE NO ACTION */
    CONSTRAINT FK_ZAKAS_POS FOREIGN KEY (TABIDPOS) 
        REFERENCES POSUDBA(TABID) 
        ON DELETE NO ACTION /* Ako postoji zakasnina, posudba se ne mo¾e obrisati */
);

/* Kreiranje jedinstvenog indeksa za kolonu TABID */
CREATE UNIQUE INDEX IDX_UNIQUE_ZAKAS_ID
ON ZAKAS (TABID);

/* Kreiranje view-a za tablicu ZAKAS s originalnim nazivima kolona */
CREATE VIEW VIEW_ZAKAS AS
    SELECT 
        TABID AS ID, /* ID zakasnine */
        TABIDCLAN AS IDCLAN, /* ID èlana */
        TABIDPOS AS IDPOS, /* ID posudbe */
        TABZAKDAT AS ZAKDAT, /* Datum zakasnine */
        TABIZNOS AS IZNOS /* Iznos zakasnine */
 FROM ZAKAS;
 
/* Dodavanje komentara na stupce */
COMMENT ON COLUMN ZAKAS.TABID 
    IS 'TABID - ID zakasnine';

COMMENT ON COLUMN ZAKAS.TABIDCLAN 
    IS 'TABIDCLAN - ID èlana';

COMMENT ON COLUMN ZAKAS.TABIDPOS 
    IS 'TABIDPOS - ID posudbe';

COMMENT ON COLUMN ZAKAS.TABZAKDAT 
    IS 'TABZAKDAT - Datum zakasnine';

COMMENT ON COLUMN ZAKAS.TABIZNOS 
    IS 'TABIZNOS - Iznos zakasnine';
